<%= render "components/navbar" %>

<div class="container-msg">
  <div class="row">
    <div class="col-3">
      <h4><br>Messages<br></h4>

      <% @exchanges_infos.each do |exchange| %>
        <%= link_to edit_exchange_path(exchange[0]) do %>
          <div class="div p-3">
            <div class="d-flex align-items-center">
              <%= cl_image_tag exchange[1].photo.key, crop: :fill, class: "avatar mr-3" %>
                <div class="div-left">
                  <div class="name-msg-left"><%= exchange[1].first_name %></div>
                  <div class="msg-left"><%= exchange[2] %></div>
                </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <div class="chatroom col-5" data-controller="exchange-subscription" data-exchange-subscription-exchange-id-value="<%= @exchange.id %>">
      <h4><br><%= @other_user.first_name %> <br><br></h4>
      <div class="messages" data-exchange-subscription-target="messages">
        <% @exchange.messages.each do |message| %>
          <%= render "messages/message", message: message %>
        <% end %>
      </div>

      <%= simple_form_for [@exchange, @message], html: { data: { action: "turbo:submit-end->exchange-subscription#resetForm" }, class: "d-flex" } do |f| %>
        <%= f.input :content, placeholder: "Type something", label: false, wrapper_html: { class: "flex-grow-1" } %>
        <%= f.submit "Send", class: "btn btn-primary mb-3" %>
      <% end %>
    </div>

    <div class="col-4">
      <h4><br>Modalities <br><br></h4>
      <% @exchange_modalities.each do |modality| %>
        <div>
          <%= simple_form_for(modality, as: :modality, method: :patch, url: modality_path(modality), data: { controller: 'flatpickr' }) do |f|%>
          <%= f.input :duration, placeholder: "How long do you want to exchange ?" %>
          <%= f.input :check_in, as: :string, label: 'Choose your dates ! 🗓', placeholder: "Pick your dates !",  input_html: { data: { flatpickr_target: "checkIn" } } %>
          <%= f.input :keys, placeholder: "How about the keys ? 🗝" %>
          <%= f.input :petsitting, placeholder: "Can you take care of your host's pet ? 🐶" %>
          <%= f.input :transportation, placeholder: "Does your host can use your transportation ? 🚲" %>
          <%= f.input :others, placeholder: "Anything else to tell your colleague ? 🤔" %>
          <%= f.submit "+ Submit" %>
          <div class="separator"></div>
          <% end %>
        </div>
      <% end %>
      <div class="link-validate">
        <%= link_to "Validate exchange", exchange_path(@exchange) %>
      </div>
    </div>
  </div>
</div>
